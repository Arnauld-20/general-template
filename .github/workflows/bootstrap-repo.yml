name: Bootstrap New Repo from Template

on:
  workflow_dispatch:
    inputs:
      new_repo_name:
        description: "New repository name (e.g., devops-infra)"
        required: true
      visibility:
        description: "Visibility"
        type: choice
        options: [private, public, internal]
        default: private

permissions:
  contents: read

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    env:
       GH_TOKEN: ${{ github.token }} # PAT with repo + workflow
    steps:
      - name: Confirm this repo is a template
        run: |
          is_template=$(gh repo view "$GITHUB_REPOSITORY" --json isTemplate -q .isTemplate)
          if [ "$is_template" != "true" ]; then
            echo "::error::Enable 'Template repository' in Settings â†’ General for this repo."
            exit 1
          fi

      - name: Create new repo from this template
        id: create
        run: |
          OWNER="${{ github.repository_owner }}"
          NAME="${{ inputs.new_repo_name }}"
          VIS="${{ inputs.visibility }}"
          gh repo create "$OWNER/$NAME" --template "$GITHUB_REPOSITORY" --"$VIS" --enable-issues --disable-wiki
          echo "url=https://github.com/$OWNER/$NAME" >> $GITHUB_OUTPUT
          echo "### Created: https://github.com/$OWNER/$NAME" >> $GITHUB_STEP_SUMMARY
